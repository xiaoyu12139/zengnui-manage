const{ipcRenderer}=require("electron"),fs=require("fs"),path=require("path"),ipcSendSync=(e,...n)=>{const i=ipcRenderer.sendSync("ffffffff.services",e,...n);if(i instanceof Error)throw i;return i},ipcInvoke=async(e,...n)=>{try{return await ipcRenderer.invoke("ffffffff.services",e,...n)}catch(e){throw new Error(e.message.replace(/^.*?Error:/,"").trim())}},ipcSend=(e,...n)=>{ipcRenderer.send("ffffffff.services",e,...n)};window.CONTEXT_ENV=ipcSendSync("contextEnv"),window.services={showHelpGuide:()=>{ipcSend("showHelpGuide")},getMessageBadge:()=>ipcSendSync("getMessageBadge"),clearMessageBadge:()=>ipcSendSync("clearMessageBadge"),setMainMode:e=>ipcSendSync("setMainMode",e),setDisableRenderRecent:e=>ipcSendSync("setDisableRenderRecent",e),setEnableTopDot:e=>ipcSendSync("setEnableTopDot",e),setOpenAtLogin:e=>ipcSendSync("setOpenAtLogin",e),setSpaceAsEnter:e=>ipcSendSync("setSpaceAsEnter",e),setShowHotKey:e=>ipcSendSync("setShowHotKey",e),setPluginDetachHotKey:e=>ipcSendSync("setPluginDetachHotKey",e),setAutoPasteLife:e=>ipcSendSync("setAutoPasteLife",e),setPluginOutTimer:e=>ipcSendSync("setPluginOutTimer",e),getAllSettings:()=>ipcSendSync("getAllSettings"),setTheme:e=>ipcSendSync("setTheme",e),setMainWindowOpacity:e=>ipcSendSync("setMainWindowOpacity",e),setEnableNativeApp:e=>ipcSendSync("setEnableNativeApp",e),setMainPlaceholder:e=>ipcSendSync("setMainPlaceholder",e),setConnReceiveDir:e=>ipcSendSync("setConnReceiveDir",e),setGlobalProxyUrl:e=>ipcSendSync("setGlobalProxyUrl",e),setEnableGlobalProxy:e=>ipcSendSync("setEnableGlobalProxy",e),createMainCmdMenu:(e,n,i)=>ipcInvoke("createMainCmdMenu",e,n,i),getMainCmdMenu:(e,n)=>ipcSendSync("getMainCmdMenu",e,n),removeMainCmdMenu:e=>ipcInvoke("removeMainCmdMenu",e),getVoicePanelMenu:(e,n)=>ipcSendSync("getVoicePanelMenu",e,n),createVoicePanelMenu:(e,n,i)=>ipcInvoke("createVoicePanelMenu",e,n,i),removeVoicePanelMenu:e=>ipcInvoke("removeVoicePanelMenu",e),getVoicePanelSettings:()=>ipcSendSync("getVoicePanelSettings"),setEnableVoicePanel:e=>ipcSendSync("setEnableVoicePanel",e),setVoicePanelEnableVoice:e=>ipcSendSync("setVoicePanelEnableVoice",e),setVoicePanelEnableTranslate:e=>ipcSendSync("setVoicePanelEnableTranslate",e),setVoicePanelEnableAutoPin:e=>ipcSendSync("setVoicePanelEnableAutoPin",e),setVoicePanelTriggerWay:e=>ipcSendSync("setVoicePanelTriggerWay",e),setVoicePanelLongDownTriggerMS:e=>ipcSendSync("setVoicePanelLongDownTriggerMS",e),setVoicePanelProcessBlacklist:e=>ipcSendSync("setVoicePanelProcessBlacklist",e),setVoicePanelWallpaper:e=>ipcInvoke("setVoicePanelWallpaper",e),getVoicePanelCustomWallpapers:()=>ipcSendSync("getVoicePanelCustomWallpapers"),removeVoicePanelCustomWallpaper:e=>ipcSendSync("removeVoicePanelCustomWallpaper",e),getAllFeatureHotKey:()=>ipcSendSync("getAllFeatureHotKey"),createFeatureHotKey:e=>ipcSendSync("createFeatureHotKey",e),deleteFeatureHotKey:e=>ipcSendSync("deleteFeatureHotKey",e),updateFeatureHotKeyHotKey:(e,n)=>ipcSendSync("updateFeatureHotKeyHotKey",e,n),updateFeatureHotKeyCmd:(e,n)=>ipcSendSync("updateFeatureHotKeyCmd",e,n),getAllAliasRedirect:()=>ipcSendSync("getAllAliasRedirect"),createAliasRedirect:e=>ipcSendSync("createAliasRedirect",e),deleteAliasRedirect:e=>ipcSendSync("deleteAliasRedirect",e),updateAliasRedirectAlias:(e,n)=>ipcSendSync("updateAliasRedirectAlias",e,n),updateAliasRedirectCmd:(e,n)=>ipcSendSync("updateAliasRedirectCmd",e,n),updateAliasRedirectIcon:(e,n)=>ipcInvoke("updateAliasRedirectIcon",e,n),getLocalAccount:()=>ipcSendSync("getLocalAccount"),renewLocalAccount:()=>ipcInvoke("renewLocalAccount"),setOpenDbSync:e=>ipcInvoke("setOpenDbSync",e),loginAccount:(e,n)=>ipcInvoke("loginAccount",e,n),logout:e=>{ipcSendSync("logout",e)},goEmailVerify:()=>{ipcSend("goEmailVerify")},goHomePage:()=>{ipcSend("goHomePage")},createPluginId:e=>ipcInvoke("createPluginId",e),deployPlugin:e=>ipcInvoke("deployPlugin",e),getRemoteDbDocCount:()=>ipcInvoke("getRemoteDbDocCount"),getRemoteDbInfo:()=>ipcInvoke("getRemoteDbInfo"),getDbStatistics:()=>ipcInvoke("getDbStatistics"),clearDbPluginData:(e,n)=>ipcInvoke("clearDbPluginData",e,n),getDbDoc:(e,n)=>ipcInvoke("getDbDoc",e,n),getDbInfoDocCount:()=>ipcInvoke("getDbInfoDocCount"),rewriteLocalDbNotSyncDocs:()=>ipcInvoke("rewriteLocalDbNotSyncDocs"),getCopyFiles:()=>ipcSendSync("getCopyFiles"),getNativeWorkWindowInfo:()=>ipcSendSync("getNativeWorkWindowInfo"),addLocalOpen:e=>ipcSendSync("addLocalOpen",e),removeLocalOpen:e=>ipcSendSync("removeLocalOpen",e),getLocalOpenFeatures:()=>ipcSendSync("getLocalOpenFeatures"),getPluginContainer:()=>ipcSendSync("getPluginContainer"),getPluginConfig:e=>ipcSendSync("getPluginConfig",e),getPluginUpdateSet:()=>ipcSendSync("getPluginUpdateSet"),getDisabledCmdContainer:()=>ipcSendSync("getDisabledCmdContainer"),getDisableCmds:e=>ipcSendSync("getDisableCmds",e),addDisableCmd:(e,n,i,c)=>ipcSendSync("addDisableCmd",e,n,i,c),removeDisableCmd:e=>ipcSendSync("removeDisableCmd",e),getPluginMenuSetting:e=>ipcSendSync("getPluginMenuSetting",e),addOutKillPlugin:e=>ipcSendSync("addOutKillPlugin",e),removeOutKillPlugin:e=>ipcSendSync("removeOutKillPlugin",e),addEnterDetachPlugin:e=>ipcSendSync("addEnterDetachPlugin",e),removeEnterDetachPlugin:e=>ipcSendSync("removeEnterDetachPlugin",e),addPluginRunAtAppOpen:e=>ipcSendSync("addPluginRunAtAppOpen",e),removePluginRunAtAppOpen:e=>ipcSendSync("removePluginRunAtAppOpen",e),setPluginMainPushPower:(e,n)=>ipcSendSync("setPluginMainPushPower",e,n),disableDbSyncRemind:()=>ipcSendSync("disableDbSyncRemind"),isDisabledDbSyncRemind:()=>ipcSendSync("isDisabledDbSyncRemind"),reportCDNError:()=>{ipcSend("reportCDNError")},refreshAccountAvatar:()=>{ipcSend("refreshAccountAvatar")},getRunningPlugins:()=>ipcSendSync("getRunningPlugins"),killPlugin:e=>ipcSendSync("killPlugin",e),killAllPlugins:()=>ipcSendSync("killAllPlugins"),readPluginInfoFromUpxs:e=>ipcInvoke("readPluginInfoFromUpxs",e),removePlugin:e=>!!ipcSendSync("pluginUnMount",e)&&(ipcSend("destroyPlugin",e),ipcSend("refreshCmdSource"),!0),installPlugin:async(e,n)=>{const i=await n.arrayBuffer(),c=path.join(window.utools.getPath("temp"),"utools-"+e+"-"+Date.now()+(n.ext||".upxs"));fs.writeFileSync(c,Buffer.from(i));try{await ipcInvoke("pluginInstall",e,c)}catch(e){try{fs.unlinkSync(c)}catch{}throw e}try{fs.unlinkSync(c)}catch{}ipcSend("destroyPlugin",e),ipcSend("refreshCmdSource");const t=ipcSendSync("getPluginConfig",e);if(!t)return;let a=window.utools.db.get("installed/"+e);const o=Date.now();a||(a={_id:"installed/"+e,createTime:o}),a.name=t.name,a.pluginName=t.pluginName,a.description=t.description||"",a.author=t.author,a.updateTime=o,window.utools.db.put(a)},unsafePluginInstall:async e=>{const n=await ipcInvoke("pluginInstall","",e);ipcSend("destroyPlugin",n),ipcSend("refreshCmdSource")},autoLoadPlugin:(e,n,i)=>{ipcSend("autoLoadPlugin",e,n,i)},getFileBlob:e=>{let n;try{n=fs.readFileSync(e)}catch{return null}return new window.Blob([Uint8Array.from(n).buffer])},getFileName:e=>path.parse(e).name,detectConnection:()=>ipcInvoke("detectConnection"),changeActiveTeam:e=>ipcSendSync("changeActiveTeam",e)};